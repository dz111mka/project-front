<html lang="RU">
<head>
    <title>RPG</title>
    <script src=https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="../css/my.css" rel="stylesheet">
</head>
<body onload="addToTable(0)">
<div class="wrapper">
    <h1>RPG admin panel</h1>
    <h2>Accounts list</h2>

    <label for="count_1">Count per page: </label>
    <select id="count_1" onchange="addToTable(0)">
        <option value="3">3</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
    </select>
    <table id="table_1">
        <tr>
            <td>#</td>
            <td>Name</td>
            <td>Title</td>
            <td>Race</td>
            <td>Profession</td>
            <td>Level</td>
            <td>Birthday</td>
            <td>Banned</td>
            <td>Delete</td>
            <td>Edit</td>
        </tr>
    </table>
    <div id="paging_buttons">Pages</div>

    <div>Create new account:</div>

    <div id="createName" class="createBlock">
        <div class="createNaming">Name: </div>
        <div class="createField"><label for="createNameSelect"></label><input id="createNameSelect"></div>
    </div>
    <div id="createTitle" class="createBlock">
        <div class="createNaming">Title: </div>
        <div class="createField"><label for="createTitleSelect"></label><input id="createTitleSelect"></div>
    </div>
    <div id="createRace" class="createBlock">
        <div class="createNaming">Race:</div>
        <div class="createField">
            <label  for="createRaceSelect"></label>
            <select id="createRaceSelect">
                <option value="HUMAN">HUMAN</option>
                <option value="DWARF">DWARF</option>
                <option value="ELF">ELF</option>
                <option value="GIANT">GIANT</option>
                <option value="ORC">ORC</option>
                <option value="TROLL">TROLL</option>
                <option value="HOBBIT">HOBBIT</option>
            </select>
        </div>
    </div>
    <div id="createProfession" class="createBlock">
        <div class="createNaming">Profession:</div>
        <div class="createField">
            <label for="createProfessionSelect"></label>
            <select id="createProfessionSelect">
                <option value="WARRIOR">WARRIOR</option>
                <option value="ROGUE">ROGUE</option>
                <option value="SORCERER">SORCERER</option>
                <option value="CLERIC">CLERIC</option>
                <option value="PALADIN">PALADIN</option>
                <option value="NAZGUL">NAZGUL</option>
                <option value="WARLOCK">WARLOCK</option>
                <option value="DRUID">DRUID</option>
            </select>
        </div>
    </div>
    <div id="createLevel" class="createBlock">
        <div class="createNaming">Level: </div>
        <div class="createField"><label for="createLevelSelect"></label><input id="createLevelSelect"></div>
    </div>
    <div id="createBirthday" class="createBlock">
        <div class="createNaming">Birthday:</div>
        <div class="createField"><label for="createBirthdaySelect"></label><input id="createBirthdaySelect" type="datetime-local"></div>
    </div>
    <div id="createBanned" class="createBlock">
        <div class="createNaming">Banned:</div>
        <div class="createField">
            <label for="createBannedSelect"></label>
            <select id="createBannedSelect">
                <option value="true">true</option>
                <option value="false">false</option>
            </select>
        </div>
    </div>

    <div class="createButtonWrapper">
        <svg id="createButton" onclick="createAccount()" xmlns="http://www.w3.org/2000/svg" height="4em" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V173.3c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32H64zm0 96c0-17.7 14.3-32 32-32H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
    </div>
</div>
<script>


    function addToTable(page_number) {
        $("tr:has(td.item)").remove();

        let countPerPage = $("#count_1").val();

        if (countPerPage == null) {
            countPerPage = 3;
        }

        if (page_number == null) {
            page_number = 0;
        }

        let url = "rest/players?".concat("pageSize=").concat(countPerPage).concat("&pageNumber=").concat(page_number);

        console.log(url);

        $.get(url, function (data) {
            $.each(data, function (i, item) {
                $("<tr>").html("<td class='id" + item.id + "'>"
                    + item.id + "</td><td class='name" + item.id + "'>"
                    + item.name + "</td><td class='title" + item.id + "'>"
                    + item.title + "</td><td class='race" + item.id + "'>"
                    + item.race + "</td><td class='profession" + item.id + "'>"
                    + item.profession + "</td><td class='level" + item.id + "'>"
                    + item.level + "</td><td class='date" + item.id + "'>"
                    + new Date(item.birthday).toLocaleString() + "</td><td class='banned" + item.id + "'>"
                    + item.banned + "</td><td class='item deleteAcc" + item.id + "'><svg id='deleteAcc" + item.id + "' onclick='deleteAccount(" + item.id + ")' xmlns=\"http://www.w3.org/2000/svg\" height=\"1em\" viewBox=\"0 0 448 512\"><path d=\"M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z\"/></svg></td>"
                    + "<td class='item editAcc" + item.id + "'><svg id='editAcc" + item.id + "' onclick='editAccount(" + item.id + ")' xmlns=\"http://www.w3.org/2000/svg\" height=\"1em\" viewBox=\"0 0 512 512\"><path d=\"M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z\"/></svg></td> ")
                    .appendTo("#table_1");
            })
        })

        let totalCountAccount = getTotalAccount();


        let pagesCount = Math.ceil(totalCountAccount / countPerPage);
        $("button.pgn_btn_style").remove();

        $("#paging_buttons").append($("<button>" + 1 + "</button>")
            .attr("id", "paging_btn0")
            .attr("onclick", "addToTable(" + 0 + ")")
            .addClass("pgn_btn_style activ"));


        for (let i = 1; i < pagesCount; i++) {

            $("#paging_buttons").append($("<button>" + (i + 1) + "</button>")
                .attr("id", "paging_btn" + i)
                .attr("onclick", "addToTable(" + i + ")")
                .addClass("pgn_btn_style"));
        }

        let activeBtn = "#paging_btn" + page_number;

        $(".pgn_btn_style").removeClass("activ");
        $(activeBtn).addClass("activ");


    }

    function getTotalAccount() {
        let url = "rest/players/count";
        let res = 0;
        $.ajax({
            method: "GET",
            url: url,
            async: false,
            success: function totalCount(data) {
                res = data;
            }
        });
        return res;
    }

    function deleteAccount(id) {
        let url = "/rest/players/" + id;
        $.ajax({
            url: url,
            type: "delete",
            success: function () {
                addToTable(Number($("button.activ").text()) - 1);
            }
        });
    }
    
    function editAccount(id) {

        let id_edit = "#editAcc" + id;
        let id_del = "#deleteAcc" + id;

        $(id_del).remove();

        let save_image_tag = "<svg id='saveAcc" + id + "' onclick='saveAccount(" + id + ")' xmlns=\"http://www.w3.org/2000/svg\" height=\"1em\" viewBox=\"0 0 448 512\"><path d=\"M48 96V416c0 8.8 7.2 16 16 16H384c8.8 0 16-7.2 16-16V170.5c0-4.2-1.7-8.3-4.7-11.3l33.9-33.9c12 12 18.7 28.3 18.7 45.3V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96C0 60.7 28.7 32 64 32H309.5c17 0 33.3 6.7 45.3 18.7l74.5 74.5-33.9 33.9L320.8 84.7c-.3-.3-.5-.5-.8-.8V184c0 13.3-10.7 24-24 24H104c-13.3 0-24-10.7-24-24V80H64c-8.8 0-16 7.2-16 16zm80-16v80H272V80H128zm32 240a64 64 0 1 1 128 0 64 64 0 1 1 -128 0z\"/></svg>";
        $(".editAcc" + id).html(save_image_tag);

        let editName = $(".name" + id);
        editName.html("<input id='input_name" + id + "' type='text' value='" + editName.text() + "'>");

        let editTitle = $(".title" + id);
        editTitle.html("<input id='input_title" + id + "' type='text' value='" + editTitle.text() + "'>");

        let editRace = $(".race" + id);
        editRace.html("<input id='input_race" + id + "' type='text' value='" + editRace.text() + "'>");

        let editProfession = $(".profession" + id);
        editProfession.html("<input id='input_profession" + id + "' type='text' value='" + editProfession.text() + "'>");

        let editBanned = $(".banned" + id);
        editBanned.html("<input id='input_banned" + id + "' type='text' value='" + editBanned.text() + "'>");
    }
    
    function saveAccount(id) {
        let url = "/rest/players/" + id;

        $.ajax({
            url: url,
            type: 'POST',
            dataType: 'json',
            data: JSON.stringify({
                name: $("#input_name" + id).val(),
                title: $("#input_title" + id).val(),
                race: $("#input_race" + id).val(),
                profession: $("#input_profession" + id).val(),
                banned: $("#input_banned" + id).val()}),
            contentType: 'application/json',
            success: function(response) {
                console.log(response)
                addToTable(Number($("button.activ").text()) - 1);
            }
        });
    }
    
    function createAccount() {
        let url = "/rest/players/"

        console.log($("#createNameSelect").val())
        console.log($("#createTitleSelect").val())
        console.log($("#createRaceSelect").val())
        console.log($("#createProfessionSelect").val())
        console.log($("#createBannedSelect").val())
        console.log($("#createLevelSelect").val())
        console.log($("#createBirthdaySelect").val())



        $.ajax({
            url: url,
            type: "POST",
            dataType: "json",
            data: JSON.stringify({
                "name": $("#createNameSelect").val(),
                "title": $("#createTitleSelect").val(),
                "race": $("#createRaceSelect").val(),
                "profession": $("#createProfessionSelect").val(),
                "banned": $("#createBannedSelect").val(),
                "level": $("#createLevelSelect").val(),
                "birthday": new Date($("#createBirthdaySelect").val()).getTime(),
            }),
            contentType: 'application/json',
            success: function(response) {
                console.log(response)
                addToTable(Number($("button.activ").text()) - 1);
            }
        })
    }

</script>
</body>
</html>